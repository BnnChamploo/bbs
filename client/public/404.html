<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>班德尔密林</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript">
      // GitHub Pages 路由重定向
      // 单页应用 (SPA) 路由支持
      var l = window.location;
      var basePath = '/bbs';
      var indexPath = basePath + '/index.html';
      
      // 如果当前路径已经是 index.html 或根路径，不要重定向（避免死循环）
      // 注意：对于带查询参数的根路径（如 /bbs/?category=plaza），GitHub Pages 会直接返回 index.html，不会触发 404.html
      // 但如果确实触发了 404.html，说明路径有问题，需要重定向
      if (l.pathname === indexPath || l.pathname === basePath + '/' || l.pathname === basePath) {
        // 如果路径是根路径但带查询参数，保存查询参数并重定向到 index.html
        if (l.search || l.hash) {
          // 保存查询参数和 hash 到 sessionStorage，让 React Router 处理
          // 注意：只保存查询参数和hash，不包含路径
          sessionStorage.setItem('redirectPath', l.search + l.hash);
          l.replace(l.protocol + '//' + l.hostname + (l.port ? ':' + l.port : '') + indexPath);
        } else {
          // 已经是正确的路径，不需要重定向
          return;
        }
      }
      
      // 如果路径以 /index.html 结尾，说明已经在重定向循环中，直接返回
      if (l.pathname.endsWith('/index.html') && l.pathname !== indexPath) {
        // 已经在重定向循环中，直接跳转到根路径
        l.replace(l.protocol + '//' + l.hostname + (l.port ? ':' + l.port : '') + indexPath);
        return;
      }
      
      // 处理 URL 中的 ?/ 格式（旧的重定向格式）
      var path = l.pathname;
      var search = l.search;
      var hash = l.hash;
      
      // 如果 URL 包含 ?/ 格式，提取实际路径
      if (search.includes('?/')) {
        var parts = search.split('?/');
        if (parts.length > 1) {
          path = basePath + '/' + parts[1].replace(/~and~/g, '&').split('&')[0];
          search = '';
        }
      }
      
      // 移除路径中的 index.html（如果存在）
      path = path.replace(/\/index\.html$/, '');
      
      // 确保路径以 base path 开头
      if (!path.startsWith(basePath)) {
        if (path === '/' || path === '') {
          path = basePath + '/';
        } else {
          path = basePath + path;
        }
      }
      
      // 确保路径不以 / 结尾（除非是根路径）
      if (path !== basePath && path !== basePath + '/' && path.endsWith('/')) {
        path = path.slice(0, -1);
      }
      
      // 构建新的 URL：重定向到根路径的 index.html
      // 将原始路径保存到 sessionStorage，React Router 会读取并处理
      if (path !== basePath && path !== basePath + '/') {
        // 移除 basePath 前缀，因为 React Router 的 basename 会自动处理
        var routerPath = path;
        if (path.startsWith(basePath)) {
          routerPath = path.slice(basePath.length) || '/';
        }
        // 确保路径以 / 开头
        if (!routerPath.startsWith('/')) {
          routerPath = '/' + routerPath;
        }
        sessionStorage.setItem('redirectPath', routerPath + search + hash);
      }
      
      // 重定向到 index.html（只重定向一次，避免死循环）
      var newUrl = l.protocol + '//' + l.hostname + (l.port ? ':' + l.port : '') + 
        indexPath;
      
      l.replace(newUrl);
    </script>
  </head>
  <body>
    <div style="text-align: center; padding: 50px; font-family: sans-serif;">
      <p>正在加载...</p>
      <p style="font-size: 12px; color: #666;">如果页面没有自动跳转，请<a href="/bbs/">点击这里</a></p>
    </div>
  </body>
</html>


